<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="./styles/profilestyles.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
  <header>
    <h1 class="clickable" onclick="window.location.href='index.html'">TODO Tracker</h1>

    <button class="logout-btn" onclick="logout()">Logout</button>

  </header>

  <div class="container">
    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-item">
        <label>Email</label>
        <span id="profileEmail">user@example.com</span>
      </div>
      <div class="profile-item">
        <label>Username</label>
        <span id="profileUsername">username123</span>
      </div>
    </div>

    <!-- Back Button -->
    <button class="back-btn" onclick="window.location.href='dashboard.html'">Back to Dashboard</button>
  </div>

  <!-- Toast container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
  const toastContainer = document.getElementById('toastContainer');

  function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    toastContainer.appendChild(toast);

    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  // âœ… Logout function
  function logout() {
    localStorage.removeItem('token'); // clear token
    showToast("Logged out successfully", "success");
    setTimeout(() => {
      window.location.href = "login.html"; // redirect after toast
    }, 1000);
  }

  // Fetch profile info on load
  async function fetchProfile() {
    const token = localStorage.getItem('token');
    if (!token) {
      showToast('Please login first', 'error');
      setTimeout(() => (window.location.href = "index.html"), 1000);
      return;
    }

    try {
      const res = await fetch('http://localhost:5000/profiles', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': token
        }
      });

      const data = await res.json();

      if (data.profile) {
        document.getElementById('profileEmail').textContent = data.profile.email;
        document.getElementById('profileUsername').textContent = data.profile.uname;
      } else {
        showToast(data.message || 'Error fetching profile', 'error');
      }

    } catch (err) {
      console.error('Error fetching profile:', err);
      showToast('Cannot reach backend', 'error');
    }
  }

  window.onload = fetchProfile;
</script>


</body>
</html>